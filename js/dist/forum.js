(()=>{var t={n:o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return t.d(e,{a:e}),e},d:(o,e)=>{for(var n in e)t.o(e,n)&&!t.o(o,n)&&Object.defineProperty(o,n,{enumerable:!0,get:e[n]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o),flarum.core.compat.extend;const e=flarum.core.compat["forum/app"];var n=t.n(e);const i=flarum.core.compat["common/extend"],r=flarum.core.compat["forum/components/HeaderSecondary"];var s=t.n(r);function a(t,o){return a=Object.setPrototypeOf||function(t,o){return t.__proto__=o,t},a(t,o)}function c(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,a(t,o)}const l=flarum.core.compat["common/components/NotificationsDropdown"];var u=t.n(l);const p=flarum.core.compat["common/Component"];var f=t.n(p);const v=flarum.core.compat["common/components/LoadingIndicator"];var d=t.n(v);const h=flarum.core.compat["common/components/Button"];var y=t.n(h);flarum.core.compat["common/components/Tooltip"];const w=flarum.core.compat["common/helpers/humanTime"];var g=t.n(w);const H=flarum.core.compat["common/helpers/username"];var b=t.n(H);const N=flarum.core.compat["common/helpers/avatar"];var A=t.n(N);const L=flarum.core.compat["common/components/Link"];var O=t.n(L);const _=flarum.core.compat["common/helpers/icon"];var C=t.n(_),P=function(t){function o(){return t.apply(this,arguments)||this}c(o,t);var e=o.prototype;return e.oncreate=function(o){t.prototype.oninit.call(this,o),this.state=this.attrs.state},e.deleteAll=function(t){confirm(n().translator.trans("ziven-view-history.forum.view-history-delete-all-confirmation"))&&n().store.all("viewHistory").length>0&&n().request({method:"DELETE",url:n().forum.attribute("apiUrl")+"/viewHistory/deleteAll"}).then((function(){n().store.data.viewHistory=[],m.redraw()}))},e.view=function(){if(this.state){var t=n().store.all("viewHistory");return t.sort((function(t,o){return new Date(o.assignedAt())-new Date(t.assignedAt())})),m("div",{className:"NotificationList"},m("div",{className:"NotificationList-header"},m("h4",{className:"App-titleControl App-titleControl--text"},n().translator.trans("ziven-view-history.forum.view-history")),m("div",{class:"App-primaryControl"},m(y(),{"data-container":"body",icon:"fas fa-trash-alt",className:"Button Button--link Button--icon Alert-dismiss",onclick:this.deleteAll.bind(this)}))),m("div",{className:"NotificationList-content"},m("ul",{className:"NotificationGroup-content"},t.length?t.map((function(t){var o=t.post(),e=o.user();return m("li",null,m(O(),{href:n().route.post(o),className:"Notification",onclick:function(t){t.redraw=!1}},A()(e),C()("fas",{className:"Notification-icon"}),m("span",{className:"Notification-content"},n().translator.trans("flarum-flags.forum.flagged_posts.item_text",{username:b()(o.user()),em:m("em",null),discussion:o.discussion().title()})),g()(t.assignedAt()),m("div",{className:"Notification-excerpt"},o.contentPlain())))})):this.state.loading?d().component({className:"LoadingIndicator--block"}):m("div",{className:"NotificationList-empty"},n().translator.trans("ziven-view-history.forum.view-history-empty")))))}},o}(f()),S=function(t){function o(){return t.apply(this,arguments)||this}c(o,t),o.initAttrs=function(o){o.label=app.translator.trans("ziven-view-history.forum.view-history"),o.icon="fas fa-history",t.initAttrs.call(this,o)};var e=o.prototype;return e.getMenu=function(){return m("div",{className:"Dropdown-menu "+this.attrs.menuClassName,onclick:this.menuClick.bind(this)},this.showing?P.component({state:this.attrs.state}):"")},e.goToRoute=function(){m.route.set(app.route("viewHistory"))},e.getUnreadCount=function(){return 0},e.getNewCount=function(){return this.getUnreadCount()},o}(u());const E=flarum.core.compat["common/components/FieldSet"];var x=t.n(E);const z=flarum.core.compat["common/components/SettingsPage"];var k=t.n(z);const j=flarum.core.compat["common/components/Switch"];var I=t.n(j);const T=flarum.core.compat["common/utils/ItemList"];var D=t.n(T),M=function(){function t(t){this.app=t,this.loading=!1}return t.prototype.load=function(){var t=this;this.loading=!0,m.redraw(),this.app.store.find("viewHistory").then((function(o){t.loading=!1,m.redraw()})).catch((function(){}))},t}();const B=flarum.core.compat["common/Model"];var U=t.n(B),q=function(t){function o(){return t.apply(this,arguments)||this}c(o,t);var e=o.prototype;return e.assignedAt=function(){return U().attribute("assigned_at").call(this)},e.discussion=function(){return U().hasOne("discussion").call(this)},e.post=function(){return U().hasOne("post").call(this)},e.user=function(){return U().hasOne("user").call(this)},o}(U());const F=flarum.core.compat["common/components/Page"];var G=function(t){function o(){return t.apply(this,arguments)||this}c(o,t);var e=o.prototype;return e.oninit=function(o){t.prototype.oninit.call(this,o),app.history.push("viewHistory"),app.viewHistory.load(),this.bodyClass="App--viewHistory"},e.view=function(){return m("div",{className:"ViewHistoryPage"},m(P,{state:app.viewHistory}))},o}(t.n(F)());n().initializers.add("ziven-view-history",(function(){n().store.models.viewHistory=q,n().routes.viewHistory={path:"/viewHistory",component:G},n().viewHistory=new M(n()),(0,i.extend)(s().prototype,"items",(function(t){n().session.user&&n().session.user.preferences().viewHistoryEnable&&t.add("viewHistory",m(S,{state:n().viewHistory}),20)})),(0,i.extend)(k().prototype,"settingsItems",(function(t){t.add("viewHistory",x().component({label:app.translator.trans("ziven-view-history.forum.view-history"),className:"Settings-viewHistory"},this.viewHistoryItems().toArray()))})),k().prototype.viewHistoryItems=function(){var t=this,o=new(D());return o.add("viewHistory-enable",I().component({state:this.user.preferences().viewHistoryEnable,onchange:function(o){t.viewHistoryEnableLoading=!0,t.user.savePreferences({viewHistoryEnable:o}).then((function(){t.viewHistoryEnableLoading=!1,m.redraw()}))},loading:this.viewHistoryEnableLoading},app.translator.trans("ziven-view-history.forum.view-history-enable"))),o}}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map